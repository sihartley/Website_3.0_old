function thisCartContainer(item){return document.getElementById(item.closest(".cart-container").attr("id"))}function thisGraphic(item){return document.getElementById(item.closest(".cart-container").children(".image").attr("id"))}function thisForm(item){return document.getElementById(item.closest("form").attr("id"))}function formSels(form){return Array.from(form.querySelectorAll("select"))}function formTexts(item){let form=document.getElementById(item.closest("form").attr("id"));return Array.from(form.querySelectorAll("input[type=text]"))}function colorIds(form){return Array.from(document.getElementById(form.closest("form").attr("id")).querySelectorAll("select")).map(a=>a.id).filter(id=>id.match(/color/i))}function colorOptions(itemId,colorOption){let graphic=itemId.replace(colorOption,"graphic"),design=graphic.split("_")[1],option=$(graphic).children("svg");option=$(option).find("."+colorOption);return{graphic:graphic,design:design,option:option}}function colorChange(itemId,optionId,cutout,color,background,svgGradient){let colorOption=colorOptions(itemId,optionId),colorId="#"+optionId.replace("color","")+"Gradient_";if(cutout){colorOption.option.css("fill",background)}else if(!color){$(colorOption.graphic).find(colorId+colorOption.design).html(svgGradient);colorOption.option.css("fill","url("+colorId+colorOption.design+")")}else{colorOption.option.css("fill",color)}}function textChange(data){let textInput=data.id.split("_")[0],designId="#"+thisGraphic($(data)).id,textcolor="."+textInput.replace("textinput","textcolor"),svgGraphic="."+textInput.replace("textinput","graphic"),textChange=$(designId).children("svg").children(textcolor),svgGraphicChange=$(designId).find(svgGraphic);$(textChange).find("tspan").text(data.value)}(function($,undefined){"use strict";$.widget("ui.autocomplete",$.ui.autocomplete,{_resizeMenu:function(){let ul,lis,ulW,barW;if(isNaN(this.options.maxShowItems)){return}ul=this.menu.element.scrollLeft(0).scrollTop(0).css({overflowX:"",overflowY:"",width:"",maxHeight:""});lis=ul.children("li").css("whiteSpace","nowrap");if(lis.length>this.options.maxShowItems){ulW=ul.prop("clientWidth");ul.css({overflowX:"hidden",overflowY:"auto",maxHeight:lis.eq(0).outerHeight()*this.options.maxShowItems+1});barW=ulW-ul.prop("clientWidth");ul.width("+="+barW)}ul.outerWidth(Math.max(ul.outerWidth()+1,this.element.outerWidth()))}})})($);$(function(){$("select").select2({minimumResultsForSearch:20,theme:"classic"});$(".model-year").on("select2:select",function(e){console.log(formTexts($(this)))});$(".car-color").on("select2:select",function(e){let container=thisCartContainer($(this)),colorHex="#"+$(this).find(":selected").data("hex"),cutouts=$(container).find(".cut-out, .text-cut-out");$(container).css("background-color",colorHex).trigger("change");$(cutouts).data("cutout",colorHex).trigger("change")});$(".trim-level").on("select2:select",function(e){let graphic=thisGraphic($(this)),svgfile=$(this).find(":selected").data("svg");if(svgfile){$(graphic).load(svgfile)}});$(".material").on("select2:select",function(e){let currentForm=thisForm($(this)),formSelects=formSels(currentForm),colorSelectIds=formSelects.map(a=>a.id).filter(id=>id.match(/color/i));$(thisForm($(this))).find(".brand>select").prop("disabled",false);$(colorSelectIds).each(function(){$("#"+this).find("option").not(":first, .standard-opt").remove()});let dropdown=$(this).find(":selected");$.getJSON("/data/material-data.json",function(data){let key=dropdown.val(),vals=[];switch(key){case"wet-install":$.each(data["wet-install"]["Wet-Install Premium Cast"],function(key){vals.push(key)});break;case"dry-install":$.each(data["dry-install"]["Dry-Install Premium Wrap"],function(key){vals.push(key)});break}let brand=$(currentForm).find(".brand>select");brand.empty().prop("disabled",false);$.each(vals,function(index,value){brand.append("<option value='"+value+"'>"+value+"</option>").trigger("change")})});localStorage.setItem("formId",$(currentForm).attr("id"));localStorage.setItem("material",e.params.data.id)});let brands=[];$(".brand").on({"select2:select select2:unselect":function(e){let AjaxColorsURL="/ajax/ajax-colors-automotive.php",colorSelectIds=colorIds($(this)),price=$("input[name='price']").val(),weight=$("input[name='weight']").val();brands=[];$(colorSelectIds).each(function(){$("#"+this).find("option").not(":first, .standard-opt").remove()});$($(this).find(":selected")).each(function(index,label){brands.push($(label).attr("value"))});let querySelects=colorSelectIds.map(id=>id.split("_")[0]);$.getJSON(AjaxColorsURL,{graphic:localStorage.getItem("graphicId"),form:localStorage.getItem("formId"),material:localStorage.getItem("material"),brands:brands,selects:querySelects,price:price,weight:weight},function(data){colorSelectIds.forEach(function(item){let itemId="#"+item,itemData=item.split("_")[0];$.each(data[itemData],function(i,color){$(itemId).append($("<option>",{"data-class":color.optionClasses,"data-color":color.optionHEXColor,"data-gradient":color.optionGradient,"data-svg_gradient":color.optionSVGGradient,"data-specs":color.optionSpecs,"data-priceload":color.optionPriceLoad,value:color.optionValue,text:color.optionText}))});let buildCounter=data[itemData].length+colorSelectIds.length;function cformatSelection(item){let originalOption=item.element,markup='<span class="select2-selection__selected">';if(!$(originalOption).data("color")&&!$(originalOption).data("gradient")){return $("<div>"+item.text+"</div>")}else if($(originalOption).data("color")){markup+='<span class="select2-selection__selected-tile '+$(originalOption).data("classes")+'" style="background-color:'+$(originalOption).data("color")+'"></span>'}else{markup+='<span class="select2-selection__selected-tile '+$(originalOption).data("classes")+'" style="'+$(originalOption).data("gradient")+'" data-svg_gradient="'+$(originalOption).data("svg_gradient")+'"></span>'}markup+='<span class="select2-selection__selected-title">'+item.text+"<span> (+$"+$(originalOption).data("priceload")+")</span></span>"+"</span>";return $(markup)}function cformatResult(item){buildCounter--;if(buildCounter===0){setTimeout(function(){},800)}let originalOption=item.element,markup='<div class="select2-result-container">';if($(originalOption).data("color")){markup+='<div class="select2-result-tile '+$(originalOption).data("classes")+'" style="background-color: '+$(originalOption).data("color")+';" ></div>'}else{markup+='<div class="select2-result-tile '+$(originalOption).data("classes")+'" Style="'+$(originalOption).data("gradient")+'"></div>'}markup+='<div class="select2-result-info">'+'<div class="select2-result-title">'+item.text+"</div>"+'<div class="select2-result-specs">'+$(originalOption).data("specs")+"</div>"+'<div class="select2-result-priceload"> Additional Cost $'+$(originalOption).data("priceload")+"</div>"+"</div>"+"</div>";return $(markup)}$(itemId).select2({escapeMarkup:function(markup){return markup},templateSelection:cformatSelection,templateResult:cformatResult,allowHtml:true,dropdownCssClass:"select2-drop-width"});$(itemId).on("select2:open",function(){$("input.select2-search__field").prop("placeholder","Search for color or code here")});$(itemId).on("change",function(e){let container=thisCartContainer($(this)),background=$(thisCartContainer($(this))).css("background-color"),cutout=$(this).find(":selected").data("cutout"),color=$(this).find(":selected").data("color"),gradient=$(this).find(":selected").data("gradient"),svgGradient=$(this).find(":selected").data("svg_gradient"),optionId=itemId.replace("#","").split("_")[0];if(itemId.includes("maincolor_")){colorChange(itemId,optionId,cutout,color,background,svgGradient);$.each(["accentcolor","accentcolor2","textcolor","textcolor2","textcolor3"],function(key,option){option=itemId.replace(optionId,option);$(option).children(".cut-out, .main-same, .text-cut-out, .text-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change");$(option).children(".cut-out, .text-cut-out").data("cutout",background).trigger("change")})}if(itemId.includes("accentcolor_")){colorChange(itemId,optionId,cutout,color,background,svgGradient);$.each(["accentcolor2","textcolor","textcolor2","textcolor3"],function(key,option){option=itemId.replace(optionId,option);$(option).children(".accent-same, .text-accent-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change");$(option).children(".cut-out, .text-cut-out").data("cutout",background).trigger("change")})}if(itemId.includes("accentcolor2_")){colorChange(itemId,optionId,cutout,color,background,svgGradient);$.each(["textcolor","textcolor2","textcolor3"],function(key,option){option=itemId.replace(optionId,option);$(option).children(".text-accent2-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change")})}if(itemId.includes("textcolor_")){colorChange(itemId,optionId,cutout,color,background,svgGradient);$.each(["textcolor2","textcolor3"],function(key,option){option=itemId.replace(optionId,option);$(option).children(".text-text-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change")})}if(itemId.includes("textcolor2_")){colorChange(itemId,optionId,cutout,color,background,svgGradient);$.each(["textcolor3"],function(key,option){option=itemId.replace(optionId,option);$(option).children(".text-text-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change")})}if(itemId.includes("textcolor3_")){colorChange(itemId,optionId,cutout,color,background,svgGradient)}})})})},"select2:select":function(){$(this).parent().next().fadeIn();$(this).nextAll().fadeIn().children().prop("disabled",false)},"select2:unselect":function(){let colorSelectIds=colorIds($(this)),optionSwitch=$(this).parent().next(),textOptions=thisForm($(this)).getElementsByClassName("text-option");$(colorSelectIds).each(function(){let $thisId=$("#"+this);$thisId.val("").trigger("change");if($.isEmptyObject(brands)){$thisId.prop("disabled",true).parent().fadeOut();optionSwitch.fadeOut().find("input[type='checkbox']").prop("checked",false)}});$(textOptions).each(function(){let option=$(this).find(".option");$(this).find("input[type='checkbox']").prop("checked",false);option.children().prop("disabled",true).val("").trigger("change")})}});function trimOptions(item){let originalOption=item.element;if(!$(originalOption).data("image")){return $('<div class="select2-trim-result-no_img">'+item.text+"</div>")}else{return $('<div class="select2-trim-result-container">'+'<div class="trim-image"><img src="'+$(originalOption).data("image")+'"></div>'+'<div class="info">'+'<div class="title">'+item.text+"</div>"+'<div class="specs">'+$(originalOption).data("specs")+"</div>"+"</div>"+"</div>")}}$(".trim-spec").select2({templateResult:trimOptions})});$(".options-check").click(function(){let currentForm=thisForm($(this)),textOptions=currentForm.getElementsByClassName("text-option"),options=$(this).parent().next(".options"),phrases;if($(this).is(":checked")){$(this).prev().text($(this).prev().attr("data-alt-txt"));options.fadeIn();$.ajax({url:"/ajax/ajax-autocomplete-automotive.php",data:{vehicle:localStorage.getItem("vehicleId"),vColumns:"autocomplete_phrases, image_path"},dataType:"json",async:false,success:function(data){phrases=data}});$(textOptions).each(function(){let originalTxt=$(this).find("label").text();$(this).find("input[type='checkbox']").on("change",function(){let option=$(this).parent().next(".option"),textId=option.children("input").attr("id").split("_")[0],textInputId="#"+option.find("input:text").attr("id"),svgText="."+textId.replace("textinput","textcolor"),svgGraphic="."+textId.replace("textinput","graphic"),designId="#"+thisGraphic($(this)).id,svgTextChange=$(designId).children("svg").children(svgText),svgGraphicChange=$(designId).find(svgGraphic);if($(this).is(":checked")){$(this).prev().text("Specify "+originalTxt+" & Color");option.fadeIn();option.children().prop("disabled",false);$(textInputId).autocomplete({minLength:0,source:phrases,maxShowItems:8,focus:function(event,ui){},open:function(event,ui){},response:function(event,ui){if(ui.content.length===0){}},select:function(event,ui){event.preventDefault();console.log(ui);let selected=ui.item.value,phrase=ui.item.phrase,phrase_svg=ui.item.phrase_svg;$(textInputId).val(selected).trigger("change");$(svgTextChange).find("tspan").text(selected);$.ajax({url:phrase_svg,dataType:"html",type:"GET",success:function(data){let svgContent=$(data).children().unwrap(),viewBox=$(data).attr("viewBox")}})},change:function(event,ui){},close:function(event,ui){}}).on("focus",function(){$(this).autocomplete("search","")}).data("ui-autocomplete")._renderItem=function(ul,item){return $("<li class='ui-autocomplete-row'></li>").data("item.autocomplete",item).append(item.label).appendTo(ul)}}else{$(this).prev().text(originalTxt);option.fadeOut();option.children().prop("disabled",true).val("").trigger("change");$(svgTextChange).find("tspan").text("")}})})}else{$(textOptions).each(function(){let originalText=$(this).find("label").text().replace("Specify ","").replace(" & Color",""),option=$(this).find(".option");$(this).find("input[type='checkbox']").prop("checked",false);$(this).find("label").text(originalText);option.children().prop("disabled",true).val("").trigger("change");option.fadeOut()});options.fadeOut();$(this).prev().text($(this).prev().attr("data-txt"))}});$(".buy-now-button").click(function(){let currentForm=thisForm($(this)),cartImage=currentForm.querySelector("input[name=image]"),imageVal=cartImage.value,currentGraphic=thisGraphic($(this)),currentSVG=document.getElementById(currentGraphic.id).children[0],{width,height}=currentSVG.getBBox();console.log("Add to Cart Button Clicked");console.log(currentForm.id);console.log("Cart Image");console.log(cartImage);console.log(imageVal);console.log("Current Graphic");console.log(currentGraphic.id);console.log("Current SVG");console.log(currentSVG);console.log("width: "+width);console.log("height: "+height)});