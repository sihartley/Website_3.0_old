function thisCartContainer(item){return document.getElementById(item.closest(".cart-container").attr("id"))}function thisGraphic(item){return document.getElementById(item.closest(".cart-container").children(".image").attr("id"))}function thisForm(item){return document.getElementById(item.closest("form").attr("id"))}function formSels(form){return Array.from(form.querySelectorAll("select"))}function formTexts(form){form=document.getElementById(form);return Array.from(form.querySelectorAll("input[type=text]"))}function colorIds(form){return Array.from(document.getElementById(form.closest("form").attr("id")).querySelectorAll("select")).map(a=>a.id).filter(id=>id.match(/color/i))}$(function(){$("select").select2({minimumResultsForSearch:20,theme:"classic"});$(".car-color").on("select2:select",function(e){let container=thisCartContainer($(this));let colorHex="#"+$(this).find(":selected").data("hex");let cutouts=$(container).find(".cut-out, .text-cut-out");$(container).css("background-color",colorHex).trigger("change");$(cutouts).data("cutout",colorHex).trigger("change")});$(".trim-level").on("select2:select",function(e){let graphic=thisGraphic($(this));let filename="/graphics/Vehicles/Dodge/Charger/2k15/PBHD/Charger-2k15-Hellcat-Power-Bulge-Hood-Decal-(PBHD01).svg";let svg=$(this).find(":selected").data("svg");console.log(svg);$.get(svg,function(svgfile){console.log(filename);console.log(svgfile);console.log($(graphic).find("svg"))})});$(".material").on("select2:select",function(e){let currentForm=thisForm($(this));let formSelects=formSels(currentForm);let colorSelectIds=formSelects.map(a=>a.id).filter(id=>id.match(/color/i));$(thisForm($(this))).find(".brand>select").prop("disabled",false);$(colorSelectIds).each(function(){$("#"+this).find("option").not(":first, .standard-opt").remove()});let dropdown=$(this).find(":selected");$.getJSON("/data/material-data.json",function(data){let key=dropdown.val();let vals=[];switch(key){case"wet-install":$.each(data["wet-install"]["Wet-Install Premium Cast"],function(key){vals.push(key)});break;case"dry-install":$.each(data["dry-install"]["Dry-Install Premium Wrap"],function(key){vals.push(key)});break}let brand=$(currentForm).find(".brand>select");brand.empty().prop("disabled",false);$.each(vals,function(index,value){brand.append("<option value='"+value+"'>"+value+"</option>").trigger("change")})});localStorage.setItem("formId",$(currentForm).attr("id"));localStorage.setItem("material",e.params.data.id)});let brands=[];$(".brand").on({"select2:select select2:unselect":function(e){let RequestURL="/ajax/ajax-colors-automotive.php";let colorSelectIds=colorIds($(this));let price=$("input[name='price']").val();let weight=$("input[name='weight']").val();brands=[];$(colorSelectIds).each(function(){$("#"+this).find("option").not(":first, .standard-opt").remove()});$($(this).find(":selected")).each(function(index,label){brands.push($(label).attr("value"))});let querySelects=colorSelectIds.map(id=>id.split("_")[0]);$.getJSON(RequestURL,{graphic:localStorage.getItem("graphicId"),form:localStorage.getItem("formId"),material:localStorage.getItem("material"),brands:brands,selects:querySelects,price:price,weight:weight},function(data){colorSelectIds.forEach(function(item){let itemId="#"+item;let itemData=item.split("_")[0];$.each(data[itemData],function(i,color){$(itemId).append($("<option>",{"data-class":color.optionClasses,"data-color":color.optionHEXColor,"data-gradient":color.optionGradient,"data-svg_gradient":color.optionSVGGradient,"data-specs":color.optionSpecs,"data-priceload":color.optionPriceLoad,value:color.optionValue,text:color.optionText}))});let buildCounter=data[itemData].length+colorSelectIds.length;function cformatSelection(item){let originalOption=item.element;let markup='<span class="select2-selection__selected">';if(!$(originalOption).data("color")&&!$(originalOption).data("gradient")){return $("<div>"+item.text+"</div>")}else if($(originalOption).data("color")){markup+='<span class="select2-selection__selected-tile '+$(originalOption).data("classes")+'" style="background-color:'+$(originalOption).data("color")+'"></span>'}else{markup+='<span class="select2-selection__selected-tile '+$(originalOption).data("classes")+'" style="'+$(originalOption).data("gradient")+'" data-svg_gradient="'+$(originalOption).data("svg_gradient")+'"></span>'}markup+='<span class="select2-selection__selected-title">'+item.text+"<span> (+$"+$(originalOption).data("priceload")+")</span></span>"+"</span>";return $(markup)}function cformatResult(item){buildCounter--;if(buildCounter===0){setTimeout(function(){},800)}let originalOption=item.element;let markup='<div class="select2-result-container">';if($(originalOption).data("color")){markup+='<div class="select2-result-tile '+$(originalOption).data("classes")+'" style="background-color: '+$(originalOption).data("color")+';" ></div>'}else{markup+='<div class="select2-result-tile '+$(originalOption).data("classes")+'" Style="'+$(originalOption).data("gradient")+'"></div>'}markup+='<div class="select2-result-info">'+'<div class="select2-result-title">'+item.text+"</div>"+'<div class="select2-result-specs">'+$(originalOption).data("specs")+"</div>"+'<div class="select2-result-priceload"> Additional Cost $'+$(originalOption).data("priceload")+"</div>"+"</div>"+"</div>";return $(markup)}$(itemId).select2({escapeMarkup:function(markup){return markup},templateSelection:cformatSelection,templateResult:cformatResult,allowHtml:true,dropdownCssClass:"select2-drop-width"});$(itemId).on("select2:open",function(){$("input.select2-search__field").prop("placeholder","Search for color or code here")});$(itemId).on("change",function(e){let container=thisCartContainer($(this));let background=$(thisCartContainer($(this))).css("background-color");let cutout=$(this).find(":selected").data("cutout");let color=$(this).find(":selected").data("color");let gradient=$(this).find(":selected").data("gradient");let svgGradient=$(this).find(":selected").data("svg_gradient");if(itemId.includes("maincolor_")){let graphic=itemId.replace("maincolor","graphic");let design=graphic.split("_")[1];let maincolor=$(graphic).children("svg").children(".maincolor");$.each(["accentcolor","accentcolor2","textcolor","textcolor2","textcolor3"],function(key,option){option=itemId.replace("maincolor",option);$(option).children(".cut-out, .main-same, .text-cut-out, .text-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change");$(option).children(".cut-out, .text-cut-out").data("cutout",background).trigger("change")});if(!color){$(graphic).find("#mainGradient_"+design).html(svgGradient);maincolor.css("fill","url(#mainGradient_"+design+")")}else{maincolor.css("fill",color)}}if(itemId.includes("accentcolor_")){let graphic=itemId.replace("accentcolor","graphic");let design=graphic.split("_")[1];let accentcolor=$(graphic).children("svg").children(".accentcolor");$.each(["accentcolor2","textcolor","textcolor2","textcolor3"],function(key,option){option=itemId.replace("accentcolor",option);$(option).children(".accent-same, .text-accent-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change");$(option).children(".cut-out, .text-cut-out").data("cutout",background).trigger("change")});if(cutout){accentcolor.css("fill",background)}else if(!color){$(graphic).find("#accentGradient_"+design).html(svgGradient);accentcolor.css("fill","url(#accentGradient_"+design+")")}else{accentcolor.css("fill",color)}}if(itemId.includes("accentcolor2_")){let graphic=itemId.replace("accentcolor2","graphic");let design=graphic.split("_")[1];let accentcolor2=$(graphic).children("svg").children(".accentcolor2");$.each(["textcolor","textcolor2","textcolor3"],function(key,option){option=itemId.replace("accentcolor2",option);$(option).children(".text-accent2-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change")});if(cutout){accentcolor2.css("fill",background)}else if(!color){$(graphic).find("#accent2Gradient_"+design).html(svgGradient);accentcolor2.css("fill","url(#accent2Gradient_"+design+")")}else{accentcolor2.css("fill",color)}}if(itemId.includes("textcolor_")){let graphic=itemId.replace("textcolor","graphic");let design=graphic.split("_")[1];let textcolor=$(graphic).children("svg").children(".textcolor");$.each(["textcolor2","textcolor3"],function(key,option){option=itemId.replace("textcolor",option);$(option).children(".text-text-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change")});if(cutout){textcolor.css("fill",background)}else if(!color){$(graphic).find("#textGradient_"+design).html(svgGradient);textcolor.css("fill","url(#textGradient_"+design+")")}else{textcolor.css("fill",color)}let textinput=$(this).prev().val();$(textcolor).children("tspan").text(textinput)}if(itemId.includes("textcolor2_")){let graphic=itemId.replace("textcolor2","graphic");let design=graphic.split("_")[1];let textcolor2=$(graphic).children("svg").children(".textcolor2");$.each(["textcolor3"],function(key,option){option=itemId.replace("textcolor2",option);$(option).children(".text-text-same").data("color",color).data("gradient",gradient).data("svg_gradient",svgGradient).trigger("change")});if(cutout){textcolor2.css("fill",background)}else if(!color){$(graphic).find("#text2Gradient_"+design).html(svgGradient);textcolor2.css("fill","url(#text2Gradient_"+design+")")}else{textcolor2.css("fill",color)}let textinput2=$(this).prev().val();$(textcolor2).find("tspan").text(textinput2)}if(itemId.includes("textcolor3_")){let graphic=itemId.replace("textcolor3","graphic");let design=graphic.split("_")[1];let textcolor3=$(graphic).children("svg").children(".textcolor3");if(cutout){textcolor3.css("fill",background)}else if(!color){$(graphic).find("#text3Gradient_"+design).html(svgGradient);textcolor3.css("fill","url(#text3Gradient_"+design+")")}else{textcolor3.css("fill",color)}}})})})},"select2:select":function(){$(this).parent().next().fadeIn();$(this).nextAll().fadeIn().children().prop("disabled",false)},"select2:unselect":function(){let colorSelectIds=colorIds($(this));let optionSwitch=$(this).parent().next();let textOptions=thisForm($(this)).getElementsByClassName("text-option");$(colorSelectIds).each(function(){let $thisId=$("#"+this);$thisId.val("").trigger("change");if($.isEmptyObject(brands)){$thisId.prop("disabled",true).parent().fadeOut();optionSwitch.fadeOut().find("input[type='checkbox']").prop("checked",false)}});$(textOptions).each(function(){let option=$(this).find(".option");$(this).find("input[type='checkbox']").prop("checked",false);option.children().prop("disabled",true).val("").trigger("change")})}})});$(".options-check").click(function(){let currentForm=thisForm($(this));let textOptions=currentForm.getElementsByClassName("text-option");let options=$(this).parent().next(".options");if($(this).is(":checked")){$(this).prev().text($(this).prev().attr("data-alt-txt"));options.fadeIn();$(textOptions).each(function(){let originalTxt=$(this).find("label").text();$(this).find("input[type='checkbox']").on("change",function(){let option=$(this).parent().next(".option");if($(this).is(":checked")){$(this).prev().text("Specify "+originalTxt+" & Color");option.fadeIn();option.children().prop("disabled",false)}else{$(this).prev().text(originalTxt);option.fadeOut();option.children().prop("disabled",true).val("").trigger("change")}console.log(this);console.log($(this).find("input[type='text']").id);function handleTextChange(){graphictext.innerHTML=textinput}})})}else{$(textOptions).each(function(){let originalText=$(this).find("label").text().replace("Specify ","").replace(" & Color","");let option=$(this).find(".option");$(this).find("input[type='checkbox']").prop("checked",false);$(this).find("label").text(originalText);option.children().prop("disabled",true).val("").trigger("change");option.fadeOut()});options.fadeOut();$(this).prev().text($(this).prev().attr("data-txt"))}});function textChange(data){let textInput=data.id.split("_")[0];let graphicId=thisGraphic($(data)).id;let textcolor="."+textInput.replace("textinput","textcolor");let textChange=$("#"+graphicId).children("svg").children(textcolor);$(textChange).find("tspan").text(data.value)}